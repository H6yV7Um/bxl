!function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,n){"use strict";t.a={timeline:"forever",errorLog:function(e){"string"==typeof e&&(e=new Error(e)),console.error(e)}}},function(e,t,n){"use strict";var o=n(2),i={};t.a={setCret:function(e,t){e&&(i.url=e),t&&(i.value=t)},fetch:function(e,t){return new Promise(function(n,o){var i=new XMLHttpRequest;i.open("GET",e),i.responseType=t||"json",i.withCredentials=!0,i.onload=function(){return n(i.response)},i.onerror=function(e){return o(e)},i.send()})},loadPreviewTex:function(e,t){return t=t||1e5,new Promise(function(n,o){var i=new THREE.CubeTexture,r=new Image;r.setAttribute("crossOrigin","anonymous");var a=0;r.onload=function(){for(var e,t,o=r.width,s=0;s<6;s++){e=document.createElement("canvas"),t=e.getContext("2d"),e.height=o,e.width=o,t.drawImage(r,0,o*s,o,o,0,0,o,o);var c=new Image;c.src=e.toDataURL("image/jpeg"),c.idx=s,c.onload=function(){switch(a++,this.idx){case 0:i.images[1]=this;break;case 1:i.images[4]=this;break;case 2:i.images[0]=this;break;case 3:i.images[5]=this;break;case 4:i.images[2]=this;break;case 5:i.images[3]=this}6===a&&(i.mapping=THREE.CubeRefractionMapping,i.needsUpdate=!0,n(i))}}},r.src=e,setTimeout(t,function(){return n("load images timeout")})})},loadSceneTex:function(e){var t=[this.fetch(e,"text")];return i.value?t.push(i.value):t.push(this.fetch(i.url,"text")),Promise.all(t).then(function(e){var t,n=String(e[0]).split("~#~"),r=n.slice(0,6);t=i.value?e[1]:i.value=String(e[1]).replace(/-*[A-Z\s]*-\n?/g,"").split("~#~");var a=Object(o.a)(t[0],15),s=Object(o.c)(Object(o.a)(t[1],14));if(!s.pass)throw new Error("incorrect product domian");return r.map(function(e,t){var n=s.line,i=e.substring(0,n),r=e.substring(n);return Object(o.a)(i,a)+r})})}}},function(e,t,n){"use strict";function o(e){return"skt1wins"+e}function i(e,t){return!1^t&&(t=o(a.a.timeline)),CryptoJS.AES.decrypt({ciphertext:CryptoJS.enc.Hex.parse(e),salt:CryptoJS.lib.WordArray.create(0)},t).toString(CryptoJS.enc.Utf8)}function r(e){var t=e.split("*"),n=t[1]?t[1].split(","):[],o=!0;return n.length>0&&(o=Boolean(n.find(function(e){return e==location.host}))),{line:t[0],pass:o}}n.d(t,"b",function(){return s}),t.a=i,t.c=r;var a=n(0),s=function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(4),r=(n.n(i),n(5)),a=(n.n(r),n(6)),s=n(10),c=new a.a({el:"#test"});c.subscribe("animationEnd",function(e){console.log(e)}),c.subscribe("overlayClick",function(e){"custom"!=e.actionType||o||(o=document.createElement("div"),o.className="testlabel",o.innerHTML="popup window",o.style.left=e.x+20+"px",o.style.top=e.y+20+"px",c.getRoot().appendChild(o))}),s.a.run(c,"./source.json")},function(e,t){},function(e,t){},function(e,t,n){"use strict";var o=n(7),i=n(8),r=n(9),a=n(0),s=n(1),c=n(2),u={fov:55,fog:null},h=function(){function e(e){this.source=null,this.opts=null,this.root=null,this.webgl=null,this.scene=null,this.camera=null,this.skyBox=null,this.orbitControl=null,this.deviceControl=null,this.event=new r.a,this.loader=new THREE.CubeTextureLoader,this.group=[],this.pluginList=[],this.animateList=[],this.opts=Object.assign({},u,e),this.initEnv(),this.initControl()}return e.prototype.initEnv=function(){var e=this.opts,t=this.root=document.querySelector(e.el),n=e.width||t.clientWidth||window.innerWidth,o=e.height||t.clientHeight||window.innerHeight,i=this.webgl=new THREE.WebGLRenderer({alpha:!0,antialias:!0});i.autoClear=!0,i.setPixelRatio(window.devicePixelRatio),i.setSize(n,o),t.style.cssText="position:relative;display:block;",t.appendChild(i.domElement),this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(e.fov,n/o,.1,1e4)},e.prototype.initControl=function(){var e=this.orbitControl=new o.a(this.camera,this.webgl.domElement);e.enableZoom=!0,e.enablePan=!1,e.rotateSpeed=-.2,e.target=new THREE.Vector3(0,0,1),e.target0=new THREE.Vector3(0,0,1),this.setLook(),c.b&&(this.deviceControl=new i.a(this.camera,e))},e.prototype.initMesh=function(e){var t=new THREE.MeshBasicMaterial({envMap:e,side:THREE.BackSide,refractionRatio:0,reflectivity:1}),n=new THREE.SphereGeometry(2e3,32,16),o=this.skyBox=new THREE.Mesh(n,t);this.scene.add(o),this.dispatch("previewAttach")},e.prototype.initSource=function(e){var t=this.group=e.sceneGroup,n=t.find(function(t){return t.id==e.defaultSceneId});return this.currentScene=n,n},e.prototype.updateControl=function(){this.deviceControl&&this.deviceControl.enabled?this.deviceControl.update():this.orbitControl.update()},e.prototype.setLook=function(e,t){e=e?e/180*Math.PI:Math.PI,t=t?t/180*Math.PI:Math.PI/2,this.orbitControl.setSphericalAngle(e,t),this.orbitControl.reset()},e.prototype.subscribe=function(e,t,n){this.event.on(e,t,n)},e.prototype.unsubscribe=function(e,t,n){this.event.removeListener(e,t,n)},e.prototype.dispatch=function(e,t){this.event.emit(e,t)},e.prototype.addAnimation=function(e){var t=new e(this);this.animateList.push(t)},e.prototype.addPlugin=function(e,t){var n=new e(this,t);this.pluginList.push(n)},e.prototype.render=function(e){this.webgl.render(this.scene,this.camera)},e.prototype.replaceTexture=function(e){e.mapping=THREE.CubeRefractionMapping,e.needsUpdate=!0;var t=this.skyBox.material.envMap;this.skyBox.material.envMap=e,t.dispose(),this.dispatch("sceneAttach",this.currentScene)},e.prototype.animate=function(){this.updateControl(),this.dispatch("renderProcess",this.currentScene),this.render(),requestAnimationFrame(this.animate.bind(this))},e.prototype.resize=function(){var e=this.opts,t=this.root,n=this.camera,o=e.width||t.clientWidth||window.innerWidth,i=e.height||t.clientHeight||window.innerHeight;n.aspect=o/i,n.updateProjectionMatrix(),this.webgl.setSize(o,i)},e.prototype.getCamera=function(){return this.camera},e.prototype.getCanvas=function(){return this.webgl.domElement},e.prototype.getRoot=function(){return this.root},e.prototype.getScene=function(){return this.scene},e.prototype.addObject=function(e){this.scene.add(e)},e.prototype.enterNext=function(e){var t=this;if(!e)return a.a.errorLog("no scene data provided");this.currentScene=e,s.a.loadSceneTex(e.bxlPath).then(function(e){e?t.loader.load(e,function(e){return t.replaceTexture(e)}):a.a.errorLog("load textures error")}).catch(function(e){return a.a.errorLog(e)})},e}();t.a=h},function(e,t,n){"use strict";function o(e,t){function n(){return 2*Math.PI/60/60*z.autoRotateSpeed}function o(){return Math.pow(.95,z.zoomSpeed)}function i(e){A.theta-=e}function r(e){A.phi-=e}function a(e){z.object instanceof THREE.PerspectiveCamera?F/=e:z.object instanceof THREE.OrthographicCamera?(z.object.zoom=Math.max(z.minZoom,Math.min(z.maxZoom,z.object.zoom*e)),z.object.updateProjectionMatrix(),Y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),z.enableZoom=!1)}function s(e){z.object instanceof THREE.PerspectiveCamera?F*=e:z.object instanceof THREE.OrthographicCamera?(z.object.zoom=Math.max(z.minZoom,Math.min(z.maxZoom,z.object.zoom/e)),z.object.updateProjectionMatrix(),Y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),z.enableZoom=!1)}function c(e){U.set(e.clientX,e.clientY)}function u(e){Q.set(e.clientX,e.clientY)}function h(e){W.set(e.clientX,e.clientY)}function p(e){Z.set(e.clientX,e.clientY),X.subVectors(Z,U);var t=z.domElement===document?z.domElement.body:z.domElement;i(2*Math.PI*X.x/t.clientWidth*z.rotateSpeed),r(2*Math.PI*X.y/t.clientHeight*z.rotateSpeed),U.copy(Z),z.update()}function l(e){J.set(e.clientX,e.clientY),K.subVectors(J,Q),K.y>0?a(o()):K.y<0&&s(o()),Q.copy(J),z.update()}function d(e){q.set(e.clientX,e.clientY),B.subVectors(q,W),te(B.x,B.y),W.copy(q),z.update()}function m(e){}function f(e){e.deltaY<0?s(o()):e.deltaY>0&&a(o()),z.update()}function v(e){switch(e.keyCode){case z.keys.UP:te(0,z.keyPanSpeed),z.update();break;case z.keys.BOTTOM:te(0,-z.keyPanSpeed),z.update();break;case z.keys.LEFT:te(z.keyPanSpeed,0),z.update();break;case z.keys.RIGHT:te(-z.keyPanSpeed,0),z.update()}}function E(e){U.set(e.touches[0].pageX,e.touches[0].pageY)}function b(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);Q.set(0,o)}function y(e){W.set(e.touches[0].pageX,e.touches[0].pageY)}function g(e){Z.set(e.touches[0].pageX,e.touches[0].pageY),X.subVectors(Z,U);var t=z.domElement===document?z.domElement.body:z.domElement;i(2*Math.PI*X.x/t.clientWidth*z.rotateSpeed),r(2*Math.PI*X.y/t.clientHeight*z.rotateSpeed),U.copy(Z),z.update()}function w(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);J.set(0,i),K.subVectors(J,Q),K.y>0?s(o()):K.y<0&&a(o()),Q.copy(J),z.update()}function x(e){q.set(e.touches[0].pageX,e.touches[0].pageY),B.subVectors(q,W),te(B.x,B.y),W.copy(q),z.update()}function T(e){}function R(e){if(!1!==z.enabled){switch(e.preventDefault(),e.button){case z.mouseButtons.ORBIT:if(!1===z.enableRotate)return;c(e),V=D.ROTATE;break;case z.mouseButtons.ZOOM:if(!1===z.enableZoom)return;u(e),V=D.DOLLY;break;case z.mouseButtons.PAN:if(!1===z.enablePan)return;h(e),V=D.PAN}V!==D.NONE&&(document.addEventListener("mousemove",O,!1),document.addEventListener("mouseup",H,!1),z.dispatchEvent(_))}}function O(e){if(!1!==z.enabled)switch(e.preventDefault(),V){case D.ROTATE:if(!1===z.enableRotate)return;p(e);break;case D.DOLLY:if(!1===z.enableZoom)return;l(e);break;case D.PAN:if(!1===z.enablePan)return;d(e)}}function H(e){!1!==z.enabled&&(m(e),document.removeEventListener("mousemove",O,!1),document.removeEventListener("mouseup",H,!1),z.dispatchEvent(I),V=D.SLIDER)}function k(e){!1===z.enabled||!1===z.enableZoom||V!==D.NONE&&V!==D.ROTATE||(e.preventDefault(),e.stopPropagation(),f(e),z.dispatchEvent(_),z.dispatchEvent(I))}function P(e){!1!==z.enabled&&!1!==z.enableKeys&&!1!==z.enablePan&&v(e)}function M(e){if(!1!==z.enabled){switch(e.touches.length){case 1:if(!1===z.enableRotate)return;E(e),V=D.TOUCH_ROTATE;break;case 2:if(!1===z.enableZoom)return;b(e),V=D.TOUCH_DOLLY;break;case 3:if(!1===z.enablePan)return;y(e),V=D.TOUCH_PAN;break;default:V=D.NONE}V!==D.NONE&&z.dispatchEvent(_)}}function j(e){if(!1!==z.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===z.enableRotate)return;if(V!==D.TOUCH_ROTATE)return;g(e);break;case 2:if(!1===z.enableZoom)return;if(V!==D.TOUCH_DOLLY)return;w(e);break;case 3:if(!1===z.enablePan)return;if(V!==D.TOUCH_PAN)return;x(e);break;default:V=D.NONE}}function L(e){!1!==z.enabled&&(T(e),z.dispatchEvent(I),V=D.SLIDER)}function C(e){!1!==z.enabled&&e.preventDefault()}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minFov=30,this.maxFov=120,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=-1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom;var S=new THREE.Spherical,A=new THREE.Spherical,z=this,N={type:"change"},_={type:"start"},I={type:"end"},D={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5,SLIDER:6},V=D.NONE,F=1,G=new THREE.Vector3,Y=!1,U=new THREE.Vector2,Z=new THREE.Vector2,X=new THREE.Vector2,W=new THREE.Vector2,q=new THREE.Vector2,B=new THREE.Vector2,Q=new THREE.Vector2,J=new THREE.Vector2,K=new THREE.Vector2;this.getPolarAngle=function(){return S.phi},this.getAzimuthalAngle=function(){return S.theta},this.setSphericalAngle=function(e,t){S.phi=t,S.theta=e},this.saveState=function(){z.target0.copy(z.target),z.position0.copy(z.object.position),z.zoom0=z.object.zoom},this.reset=function(){z.target.copy(z.target0),z.object.position.copy(z.position0),z.object.zoom=z.zoom0,z.object.updateProjectionMatrix(),z.dispatchEvent(N),z.update(),V=D.NONE},this.update=function(){var t=new THREE.Vector3,o=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),r=o.clone().inverse(),a=new THREE.Vector3,s=new THREE.Quaternion;return function(e){var c=z.object.position;if(t.copy(c).sub(z.target),t.applyQuaternion(o),S.setFromVector3(t),z.autoRotate&&V===D.NONE)i(n());else if(V===D.SLIDER)if(X.length()>.35){var u=z.domElement===document?z.domElement.body:z.domElement;X.setLength(.9*X.length()),i(2*Math.PI*X.x/u.clientWidth*z.rotateSpeed)}else V=D.NONE;return e&&(S.theta+=e.theta,S.phi+=e.phi),S.theta+=A.theta,S.phi+=A.phi,S.theta=Math.max(z.minAzimuthAngle,Math.min(z.maxAzimuthAngle,S.theta)),S.phi=Math.max(z.minPolarAngle,Math.min(z.maxPolarAngle,S.phi)),S.makeSafe(),1!==F&&(z.object.fov*=F,z.object.fov>z.maxFov?z.object.fov=z.maxFov:z.object.fov<z.minFov&&(z.object.fov=z.minFov),z.object.updateProjectionMatrix()),z.target.add(G),t.setFromSpherical(S),t.applyQuaternion(r),c.copy(z.target).add(t),z.object.lookAt(z.target),!0===z.enableDamping?(A.theta*=1-z.dampingFactor,A.phi*=1-z.dampingFactor):A.set(0,0,0),F=1,G.set(0,0,0),!!(Y||a.distanceToSquared(z.object.position)>1e-6||8*(1-s.dot(z.object.quaternion))>1e-6)&&(z.dispatchEvent(N),a.copy(z.object.position),s.copy(z.object.quaternion),Y=!1,!0)}}(),this.dispose=function(){z.domElement.removeEventListener("contextmenu",C,!1),z.domElement.removeEventListener("mousedown",R,!1),z.domElement.removeEventListener("wheel",k,!1),z.domElement.removeEventListener("touchstart",M,!1),z.domElement.removeEventListener("touchend",L,!1),z.domElement.removeEventListener("touchmove",j,!1),document.removeEventListener("mousemove",O,!1),document.removeEventListener("mouseup",H,!1),window.removeEventListener("keydown",P,!1)},this.rotateLeft=function(e){i(e)},this.rotateUp=function(e){r(e)};var $=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),G.add(e)}}(),ee=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,1),e.multiplyScalar(t),G.add(e)}}(),te=function(){var e=new THREE.Vector3;return function(t,n){var o=z.domElement===document?z.domElement.body:z.domElement;if(z.object instanceof THREE.PerspectiveCamera){var i=z.object.position;e.copy(i).sub(z.target);var r=e.length();r*=Math.tan(z.object.fov/2*Math.PI/180),$(2*t*r/o.clientHeight,z.object.matrix),ee(2*n*r/o.clientHeight,z.object.matrix)}else z.object instanceof THREE.OrthographicCamera?($(t*(z.object.right-z.object.left)/z.object.zoom/o.clientWidth,z.object.matrix),ee(n*(z.object.top-z.object.bottom)/z.object.zoom/o.clientHeight,z.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),z.enablePan=!1)}}();z.domElement.addEventListener("contextmenu",C,!1),z.domElement.addEventListener("mousedown",R,!1),z.domElement.addEventListener("wheel",k,!1),z.domElement.addEventListener("touchstart",M,!1),z.domElement.addEventListener("touchend",L,!1),z.domElement.addEventListener("touchmove",j,!1),window.addEventListener("keydown",P,!1),this.update()}o.prototype=Object.create(THREE.EventDispatcher.prototype),o.prototype.constructor=o,t.a=o},function(e,t,n){"use strict";function o(e,t){var n,o=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!1,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffsetAngle=0,this.camera=new THREE.PerspectiveCamera(55,window.innerWidth/window.innerHeight,.1,1e4);var i=function(e){o.deviceOrientation=e},r=function(){o.screenOrientation=window.orientation||0},a=function(){var e,i=new THREE.Vector3(0,0,1),r=new THREE.Euler,a=new THREE.Quaternion,s=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),c=new THREE.Spherical,u=new THREE.Spherical;return function(h,p,l,d,m){r.set(l,p,-d,"YXZ"),h.setFromEuler(r),h.multiply(s),h.multiply(a.setFromAxisAngle(i,-m)),e=o.camera.getWorldDirection(),c.setFromVector3(e),c.setFromVector3(e),n?(u.theta=c.theta-n.theta,u.phi=-c.phi+n.phi,t.update(u)):n=new THREE.Spherical,n.theta=c.theta,n.phi=c.phi}}();this.connect=function(){r(),window.addEventListener("orientationchange",r,!1),window.addEventListener("deviceorientation",i,!1),o.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",r,!1),window.removeEventListener("deviceorientation",i,!1),o.enabled=!1,n=null,o.deviceOrientation={},o.screenOrientation=0},this.update=function(){if(!1!==o.enabled){var e=o.deviceOrientation.alpha?THREE.Math.degToRad(o.deviceOrientation.alpha):0,t=o.deviceOrientation.beta?THREE.Math.degToRad(o.deviceOrientation.beta):0,n=o.deviceOrientation.gamma?THREE.Math.degToRad(o.deviceOrientation.gamma):0,i=o.screenOrientation?THREE.Math.degToRad(o.screenOrientation):0;0===e&&0===t&&0===n&&0===i||a(o.camera.quaternion,e,t,n,i)}},this.updateAlphaOffsetAngle=function(e){this.alphaOffsetAngle=e,this.update()},this.dispose=function(){this.disconnect()}}t.a=o},function(e,t,n){"use strict";function o(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function r(e,t,n,o,r){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new i(n,o||e,r),s=u?u+t:t;return e._events[s]?e._events[s].fn?e._events[s]=[e._events[s],a]:e._events[s].push(a):(e._events[s]=a,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function s(){this._events=new o,this._eventsCount=0}var c=Object.prototype.hasOwnProperty,u="~";Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(u=!1)),s.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)c.call(e,t)&&n.push(u?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},s.prototype.listeners=function(e){var t=u?u+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,r=new Array(i);o<i;o++)r[o]=n[o].fn;return r},s.prototype.listenerCount=function(e){var t=u?u+e:e,n=this._events[t];return n?n.fn?1:n.length:0},s.prototype.emit=function(e,t,n,o,i,r){var a=u?u+e:e;if(!this._events[a])return!1;var s,c,h=this._events[a],p=arguments.length;if(h.fn){switch(h.once&&this.removeListener(e,h.fn,void 0,!0),p){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,t),!0;case 3:return h.fn.call(h.context,t,n),!0;case 4:return h.fn.call(h.context,t,n,o),!0;case 5:return h.fn.call(h.context,t,n,o,i),!0;case 6:return h.fn.call(h.context,t,n,o,i,r),!0}for(c=1,s=new Array(p-1);c<p;c++)s[c-1]=arguments[c];h.fn.apply(h.context,s)}else{var l,d=h.length;for(c=0;c<d;c++)switch(h[c].once&&this.removeListener(e,h[c].fn,void 0,!0),p){case 1:h[c].fn.call(h[c].context);break;case 2:h[c].fn.call(h[c].context,t);break;case 3:h[c].fn.call(h[c].context,t,n);break;case 4:h[c].fn.call(h[c].context,t,n,o);break;default:if(!s)for(l=1,s=new Array(p-1);l<p;l++)s[l-1]=arguments[l];h[c].fn.apply(h[c].context,s)}}return!0},s.prototype.on=function(e,t,n){return r(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return r(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,n,o){var i=u?u+e:e;if(!this._events[i])return this;if(!t)return a(this,i),this;var r=this._events[i];if(r.fn)r.fn!==t||o&&!r.once||n&&r.context!==n||a(this,i);else{for(var s=0,c=[],h=r.length;s<h;s++)(r[s].fn!==t||o&&!r[s].once||n&&r[s].context!==n)&&c.push(r[s]);c.length?this._events[i]=1===c.length?c[0]:c:a(this,i)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=u?u+e:e,this._events[t]&&a(this,t)):(this._events=new o,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=u,s.EventEmitter=s,t.a=s},function(e,t,n){"use strict";var o=n(0),i=n(1),r=n(11),a=n(12),s=n(13),c=n(14);t.a={panoramList:[],cret:null,run:function(e,t){i.a.fetch(t).then(function(t){if(t&&t.sceneGroup&&t.defaultSceneId)return t.enableAnimation&&e.addAnimation(r.a),t.multiScene&&e.addPlugin(s.a,t.sceneGroup),t.info&&e.addPlugin(c.a,t.info),i.a.setCret(t.cretPath),e.initSource(t);o.a.errorLog("load source error")}).then(function(t){if(t)return t.overlays&&e.addPlugin(a.a,t),i.a.loadPreviewTex(t.imgPath);o.a.errorLog("get preview scene error")}).then(function(t){if(t)return e.initMesh(t),e.animate(),i.a.loadSceneTex(e.currentScene.bxlPath);o.a.errorLog("load preview texture error")}).then(function(t){t?e.loader.load(t,function(t){return e.replaceTexture(t)}):o.a.errorLog("load textures error")}).catch(function(e){return o.a.errorLog(e)})}}},function(e,t,n){"use strict";function o(e,t,n,o){return n*e/o+t}var i=function(){function e(e){this.time=0;var t=e.camera;this.path=this.getPath(t);this.panoram=e,this.camera=t,e.subscribe("renderProcess",this.update,this)}return e.prototype.update=function(){var e=this.camera,t=this.path,n=t[0],i=this.time;if(!n)return this.dispose();if(i>n.time)return e.fov=n.end.fov,e.position.set(n.end.px,n.end.py,n.end.pz),e.rotation.set(n.end.rx,n.end.ry,n.end.rz),e.updateProjectionMatrix(),i=this.time=0,t.shift();for(var r=0,a=t;r<a.length;r++){var s=a[r],c=o(i,s.start.px,s.end.px-s.start.px,s.time),u=o(i,s.start.py,s.end.py-s.start.py,s.time),h=o(i,s.start.pz,s.end.pz-s.start.pz,s.time),p=o(i,s.start.rx,s.end.rx-s.start.rx,s.time),l=o(i,s.start.ry,s.end.ry-s.start.ry,s.time),d=o(i,s.start.rz,s.end.rz-s.start.rz,s.time),m=o(i,s.start.fov,s.end.fov-s.start.fov,s.time);return e.fov=m,e.position.set(c,u,h),e.rotation.set(p,l,d),this.time+=16,e.updateProjectionMatrix()}},e.prototype.dispose=function(){this.panoram.dispatch("animationEnd",this),this.panoram.unsubscribe("renderProcess",this.update,this)},e.prototype.getPath=function(e){return[{start:{fov:160,px:0,py:1900,pz:0,rx:-Math.PI/2,ry:0,rz:0},end:{fov:120,px:0,py:1500,pz:0,rx:-Math.PI/2,ry:0,rz:.8*Math.PI},time:1500},{start:{fov:120,px:0,py:1500,pz:0,rx:-Math.PI/2,ry:0,rz:.8*Math.PI},end:{fov:e.fov,px:e.position.x,py:e.position.y,pz:e.position.z,rx:-Math.PI,ry:0,rz:Math.PI},time:1500}]},e}();t.a=i},function(e,t,n){"use strict";function o(e,t){var n=e.location;if(void 0!==n.h&&void 0!==n.v){var o=new THREE.Spherical,i=new THREE.Vector3;o.theta=n.h/180*Math.PI,o.phi=n.v/180*Math.PI,o.radius=1e3,i.setFromSpherical(o),e.location={x:t.position.x-i.x,y:t.position.y-i.y,z:t.position.z-i.z}}}function i(e,t){for(var n in t)e.style[n]=t[n]}var r=n(0),a=function(){function e(e,t){this.panoram=e,this.camera=e.getCamera(),this.data=t,this.loader=new THREE.TextureLoader,this.raycaster=new THREE.Raycaster,this.cache={},this.bindEvents()}return e.prototype.bindEvents=function(){var e=this,t=this.panoram;t.subscribe("sceneAttach",function(t){e.data=t,e.removeOverlays(),e.init(t)}),t.subscribe("renderProcess",function(t){e.getCache(t.id).domGroup.forEach(function(t){return e.updateDomOverlay(t)})}),t.webgl.domElement.addEventListener("click",this.onCanvasClick.bind(this))},e.prototype.init=function(e){var t=this;e.id||(e.id="panoram"+Date.now()),this.lastId=e.id;var n=this.getCache(e.id);(e.overlays||[]).forEach(function(e){switch(e.type){case"dom":t.createDomOverlay(e,n);break;case"mesh":t.createMeshOverlay(e,n);break;case"animation":t.createAnimationOverlay(e,n)}})},e.prototype.getCache=function(e){var t=this.cache[e];if(t)return t;var n=new THREE.Group;return this.panoram.addObject(n),this.cache[e]={domGroup:[],meshGroup:n}},e.prototype.createDomOverlay=function(e,t){var n=this;o(e,this.camera),t.domGroup.push(e);var i=document.createElement("div");i.id=e.id,i.innerHTML=e.content,i.className="panrom-domoverlay",e.cls&&(i.className+=" "+e.cls),i.onclick=function(t){return n.onOverlayClick(e,t)},this.panoram.root.appendChild(i),e.overlay=i,this.updateDomOverlay(e)},e.prototype.updateDomOverlay=function(e){var t=this.panoram.getRoot(),n=t.clientWidth/2,o=t.clientHeight/2,r=e.location,a=e.overlay,s=new THREE.Vector3(r.x,r.y,r.z),c=s.project(this.camera);if(c.z>1)a.style.display="none";else{i(a,{left:(e.x=Math.round(c.x*n+n))+"px",top:(e.y=Math.round(-c.y*o+o))+"px",display:"block"})}},e.prototype.createMeshOverlay=function(e,t){var n=this.camera,i=this.loader.load(e.img),r=new THREE.MeshBasicMaterial({map:i,side:THREE.FrontSide,transparent:!0}),a=new THREE.PlaneGeometry(1*e.width,1*e.height),s=new THREE.Mesh(a,r);o(e,n),s.position.set(e.location.x,e.location.y,e.location.z),s.name=e.id,s.data=e,e.planeMesh=s,e.rotation?s.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z):s.lookAt(n.position),t.meshGroup.add(s)},e.prototype.createAnimationOverlay=function(){},e.prototype.onCanvasClick=function(e){var t=this.panoram.webgl.domElement,n={x:e.clientX/t.clientWidth*2-1,y:-e.clientY/t.clientHeight*2+1};try{var o=this.getCache(this.data.id).meshGroup;if(o.children){this.raycaster.setFromCamera(n,this.camera);var i=this.raycaster.intersectObjects(o.children,!1);i.length>0&&this.onOverlayClick(i[0].object.data)}}catch(e){r.a.errorLog(e)}},e.prototype.onOverlayClick=function(e,t){var n=this.panoram;switch(n.dispatch("overlayClick",e),e.actionType){case"scene":n.enterNext(null);break;case"link":window.open(e.linkUrl,"_blank")}},e.prototype.removeOverlays=function(){var e=this.getCache(this.lastId);delete this.cache[this.lastId],this.lastId=null,e&&this.hideOverlays(e,!0)},e.prototype.hideOverlays=function(e,t){if(e){var n=this.panoram.getRoot();e.domGroup.forEach(function(e){var o=e.overlay;o.style.display="none",t&&n.removeChild(o)}),e.meshGroup.children&&e.meshGroup.children.forEach(function(e){e.visible=!1,e.material.map.dispose(),t&&e.remove()})}},e.prototype.showOverlays=function(e){e&&(e.domGroup.forEach(function(e){e.overlay.style.display="block"}),e.meshGroup.children.forEach(function(e){e.visible=!0}))},e.prototype.hideAnimationOverlay=function(e){e.pause(),e.getMesh().visible=!1},e.prototype.showAnimationOverlay=function(e){e.play(),e.getMesh().visible=!0},e}();t.a=a},function(e,t,n){"use strict";var o=function(){function e(e,t){this.panoram=e,this.data=t,this.createDom(),this.bindEvent()}return e.prototype.createDom=function(){var e=this.root=document.createElement("div"),t=this.outer=document.createElement("div"),n=this.inner=document.createElement("div");e.className="panoram-multiplescene",t.className="panoram-multiplescene-outer",n.className="panoram-multiplescene-inner",n.innerHTML=this.data.map(function(e,t){return'<div class="panoram-multiplescene-item" data-id="'+t+'">\n                <img src="'+e.thumbPath+'" class="panoram-multiplescene-img">\n            </div>'}).join(""),n.innerHTML+=n.innerHTML,t.appendChild(n),e.appendChild(t),this.panoram.getRoot().appendChild(e)},e.prototype.bindEvent=function(){var e=this;this.inner.addEventListener("click",function(t){var n=e.findParent(t.target,"panoram-multiplescene-item"),o=n.getAttribute("data-id"),i=e.data[o];i&&e.panoram.enterNext(i)})},e.prototype.findParent=function(e,t){for(;null!=e;){if(e.className==t)return e;e=e.parentNode}},e}();t.a=o},function(e,t,n){"use strict";var o=function(){function e(e,t){this.panoram=e,this.data=t,this.createDom()}return e.prototype.createDom=function(e,t){var n=document.createElement("div");n.className="panrom-info",n.innerHTML='<img src="'+this.data.logo+'" width="70">\n            <div class="panrom-info-name">'+this.data.author+"</div>",this.panoram.getRoot().appendChild(n)},e}();t.a=o}]);